# 3.7 네임스페이스를 사용한 리소스 그룹화

생성일: 2021년 3월 20일 오전 4:36

- 각 오브젝트는 여러 레이블을 가질 수 있음 → 오브젝트 그룹 충돌 가능
- 클러스터에서 작업을 수행할 때 레이블 셀렉터를 명시적으로 지정하지 않으면 항상 모든 오브젝트를 보게됨

Kubernetes 는 오브젝트를 네임스페이스로 그룹화

- 모든 리소스를 하나의 단일 네임스페이스에 두는 대신에 여러 네임스페이스로 분할가능
- 같은 리소스 이름을 다른 네임스페이스에 걸쳐 여러 번 사용 가능

## 1. 네임 스페이스의 필요성

- 여러 네임스페이스를 사용하면 많은 구성 요소를 가진 복잡한 시스템을 좀 더 작은 개별 그룹으로 분리가능
    - **멀티테넌트(Multi-Tenant)** 환경처럼 리소스를 분리하는 데 사용됨 (Prod, QA, Dev)
- 리소스 이름은 네임스페이스 안에서만 고유하면 된다

## 2. 다른 네임스페이스와 파드 살펴보기

클러스터에 있는 모든 네임스페이스를 나열하기

```bash
kubectl get ns
```

![3%207%20%E1%84%82%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%B7%E1%84%89%E1%85%B3%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%80%E1%85%B3%E1%84%85%E1%85%AE%E1%86%B8%E1%84%92%E1%85%AA%204dac16c9e49f4ea3b9f18552eb57b562/_2021-03-20__4.40.05.png](3%207%20%E1%84%82%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%B7%E1%84%89%E1%85%B3%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%80%E1%85%B3%E1%84%85%E1%85%AE%E1%86%B8%E1%84%92%E1%85%AA%204dac16c9e49f4ea3b9f18552eb57b562/_2021-03-20__4.40.05.png)

지금까지는 `default` 네임스페이스에서만 작업해왔다

목록을 보면 `kube-public` 과 `kube-system` 네임스페이스도 존재함

`kube-system` 네임스페이스에 속해있는 파드 보기

```bash
kubectl get po --namespace kube-system
```

![3%207%20%E1%84%82%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%B7%E1%84%89%E1%85%B3%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%80%E1%85%B3%E1%84%85%E1%85%AE%E1%86%B8%E1%84%92%E1%85%AA%204dac16c9e49f4ea3b9f18552eb57b562/Untitled.png](3%207%20%E1%84%82%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%B7%E1%84%89%E1%85%B3%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%80%E1%85%B3%E1%84%85%E1%85%AE%E1%86%B8%E1%84%92%E1%85%AA%204dac16c9e49f4ea3b9f18552eb57b562/Untitled.png)

- Kubernetes 시스템 자체와 관련된 리소스
- 만약 이 파드들이 `default` 네임스페이스 안에 있어 개발자가 직접 생성한 리소스와 섞여있다면, 어떤 리소스가 어디에 속해 있는지 구분하기 어렵게 될것
- 네임스페이스는 리소스를 격리하는것 이외에도 특정 사용자가 지정된 리소스에 접근할 수 있도록 허용
    - 개별 사용자가 사용할 수 있는 컴퓨팅 리소스를 제한하는 것도 가능

## 3. 네임 스페이스 생성

### YAML로 네임스페이스 생성

custom-namespace.yaml

```bash
apiVersion: v1
kind: Namespace //네임스페이스 정의
metadata:
  name: custom-namespace //네임스페이스 이름
```

`kubectl` 명령을 사용해 해당 파일을 Kubernetes API 서버로 전송

```bash
kubectl create -f custom-namespace.yaml
```

![3%207%20%E1%84%82%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%B7%E1%84%89%E1%85%B3%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%80%E1%85%B3%E1%84%85%E1%85%AE%E1%86%B8%E1%84%92%E1%85%AA%204dac16c9e49f4ea3b9f18552eb57b562/Untitled%201.png](3%207%20%E1%84%82%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%B7%E1%84%89%E1%85%B3%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%89%E1%85%B3%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%85%E1%85%B5%E1%84%89%E1%85%A9%E1%84%89%E1%85%B3%20%E1%84%80%E1%85%B3%E1%84%85%E1%85%AE%E1%86%B8%E1%84%92%E1%85%AA%204dac16c9e49f4ea3b9f18552eb57b562/Untitled%201.png)

`kubectl create namespace` 명령을 사용해 네임스페이스를 생성가능 (YAML 파일 작성하는 것보다 빠름)

```bash
kubectl create namespace custom-namespace
```

## 4. 다른 네임스페이스의 오브젝트 관리

- 생성한 네임스페이스 안에 리소스를 만들기 위해서는 `metadata` 섹션에
    - `namespace: custom-namespace` 항목을 넣거나
    - `kubectl create` 명령을 사용할 때 네임스페이스를 지정

```bash
kubectl create -f kubia-manual.yaml -n custom-namespace
```

이제 동일한 이름을 가진 두 파드 존재

1. 하나는 `default` 네임스페이스에 존재
2. 나머지 하나는 `custom-namespace` 에 있다

- 다른 네임스페이스 안에 있는 오브젝트를 나열하거나 어노테이션 달기, 수정 또는 삭제할 때는 `--namespace` 플래그를 `kubectl` 에 전달해야함

    ⇒ 네임스페이스를 지정하지 않으면 `kubectl` 은 현재 `kubectl` 컨텍스트에 구성돼 있는 기본 네임스페이스에서 작업을 수행

- 현재 컨텍스트의 네임스페이스와 현재 컨텍스트 자체는 `kubectl config` 명령으로 변경 가능

## 5. 네임스페이스가 제공하는 격리 이해

네임스페이스가 제공하지 않는 것

- 실행 중인 오브젝트에 대한 격리 제공 X
    - 네임 스페이스를 사용하면 오브젝트를 별도 그룹으로 분리해 특정한 네임스페이스 안에 속한 리소스를 대상으로 작업할 수 있게는 할 수 있음
- 네임스페이스에서 네트워크 격리를 제공하는지는 쿠버네티스와 함께 배포하는 네트워킹 솔루션에 따라 다름
    - 네트워크 솔루션이 네임스페이스 간 격리를 제공하지 않는 경우

        : `foo` 네임스페이스 안에 있는 파드가 `bar` 네임스페이스 안에 있는 파드의 IP 주소를 알고 있다면

        ⇒  HTTP 요청과 같은 트래픽을 다른 파드로 보낼 수 있다