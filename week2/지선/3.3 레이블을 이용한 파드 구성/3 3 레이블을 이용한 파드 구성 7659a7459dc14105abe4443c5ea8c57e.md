# 3.3 레이블을 이용한 파드 구성

생성일: 2021년 3월 19일 오후 6:55

현재까지 예제를 따라 했을 경우:

파드 두 개가 클러스터에서 실행되고 있음.

⇒ 실제 애플리케이션을 배포할 때 대부분의 사용자는 더 많은 파드를 실행하게 될 것

> 파드 수가 증가함에 따라 파드를 부분 집합으로 분류할 필요가 있다

![3%203%20%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%207659a7459dc14105abe4443c5ea8c57e/Untitled.png](3%203%20%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%207659a7459dc14105abe4443c5ea8c57e/Untitled.png)

모든 개발자/관리자는 어떤 파드가 어떤 것인지 쉽게 알 수 있도록 임의의 기준에 따라 작은 그룹으로 조직하는 방법 필요

- 각 파드에 대해 개별적으로 작업을 수행하기보다는 특정 그룹에 속한 모든 파드에 관해 한번에 작업하기
- 레이블(labels)를 통해 파드와 기타 다른 쿠버네티스 오브젝트의 조직화가 이뤄짐

## 1. 레이블(label) 소개

레이블 : 파드와 모든 다른 쿠버네티스 리소스를 조직화 할 수 있는 단순하면서 강력한 쿠버네티스 기능

- 리소스에 첨부하는 키-값 쌍
    - 이 쌍은 레이블 셀렉터를 사용해 리소스를 선택할때 활용됨
    - 키 : 해당 리소스내에서 고유하면 → 1개 이상의 원하는 만큼 레이블 소유 가능

![3%203%20%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%207659a7459dc14105abe4443c5ea8c57e/Untitled%201.png](3%203%20%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%207659a7459dc14105abe4443c5ea8c57e/Untitled%201.png)

>>>> 각 파드에 레이블을 2개씩 붙였다

- app : 파드가 속한 애플리케이션, 구성요소 혹은 마이크로서비스를 지칭
- rel: 파드에서 실행 중인 애플리케이션이 안정되었는지, 베타 혹은 카나리 릴리스(안정 버전 옆에 새 버젼을 배포하고, 모든 사용자가 access하기 전 소수만 새로운 버전을 확인할 수 있는 베타버젼)인지 보여준다

## 2. 파드를 생성할 때 레이블 지정

레이블 두개를 가진 파드를 생성해서 실제 레이블이 어떻게 동작하는 지 확인

kubia-manual-with-labels.yaml 파일 생성

```bash
apiVersion: v1
kind: Pod
metadata:
  name: kubia-manual-v2
  labels:
    creation_method: manual          //레이블 두개를 파드에 붙임
    env: prod                        //레이블 두개를 파드에 붙임
spec:
  containers:
  - image: luksa/kubia
    name: kubia
    ports:
    - containerPort: 8080
      protocol: TCP
```

```bash
kubectl create -f kubia-manual-with-labels.yaml
```

kube get pods는 레이블 표시 안해줌
`--show-labels` 옵션 추가해야 볼 수 있음

```bash
kubectl get po --show-labels
```

맨 밑의 manual-v2 파드에 부착된 레이블 확인 가능

![3%203%20%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%207659a7459dc14105abe4443c5ea8c57e/Untitled%202.png](3%203%20%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%207659a7459dc14105abe4443c5ea8c57e/Untitled%202.png)

```bash
// 특정 레이블만 관심 있는 경우 -L 사용
kubectl get po -L creation_method,env
```

## 3. 기존 파드 레이블 수정

기존 파드에 레이블 추가/수정 하기..

```bash
kubectl label po kubia-manual creation_method=manual
```

기존에 가지고 있던 레이블을 변경할때는 `--overwrite` 옵션 필요

```bash
kubectl label po kubia-manual-v2 env=debug --overwrite
kubectl get po -L creation_method,env
```

![3%203%20%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%207659a7459dc14105abe4443c5ea8c57e/Untitled%203.png](3%203%20%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%87%E1%85%B3%E1%86%AF%E1%84%8B%E1%85%B3%E1%86%AF%20%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A1%E1%84%83%E1%85%B3%20%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%207659a7459dc14105abe4443c5ea8c57e/Untitled%203.png)